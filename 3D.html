<!DOCTYPE html>
<html lang="en">
<head>
  <title>Catherine Ann MacDonald</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Security Headers -->
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="no-referrer-when-downgrade">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://ajax.googleapis.com https://cdnjs.cloudflare.com https://maxcdn.bootstrapcdn.com https://cdn.jsdelivr.net https://unpkg.com; connect-src 'self' https://derp-rex-github-io-git-main-derpasaursrexs-projects.vercel.app https://api.spotify.com https://accounts.spotify.com; style-src 'self' 'unsafe-inline' https://maxcdn.bootstrapcdn.com; img-src 'self' data: https://*.scdn.co; frame-src https://open.spotify.com; font-src 'self' data:;">
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  
  <!-- Three.js with ES Module imports for OBJ loading -->
  <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
      }
    }
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const numFollowers = 5;
      const followers = [];
      const positions = [];
      let isMouseOnPage = false;
      
      for (let i = 0; i < numFollowers; i++) {
        const follower = document.createElement('img');
        follower.src = 'SitePics/Bugtie.png';
        follower.style.position = 'fixed';
        follower.style.width = '30px';
        follower.style.height = '30px';
        follower.style.pointerEvents = 'none';
        follower.style.zIndex = '9999';
        follower.style.display = 'none';
        follower.style.transition = 'left 0.1s ease-out, top 0.1s ease-out';
        document.body.appendChild(follower);
        
        followers.push(follower);
        positions.push({ x: 0, y: 0 });
      }
      
      function animate() {
        if (isMouseOnPage && followers[0].style.display !== 'none') {
          for (let i = 0; i < numFollowers; i++) {
            const follower = followers[i];
            const pos = positions[i];
            
            let targetX, targetY;
            if (i === 0) {
              targetX = window.mouseX;
              targetY = window.mouseY;
            } else {
              const prevPos = positions[i - 1];
              targetX = prevPos.x;
              targetY = prevPos.y;
            }
            
            const dx = targetX - pos.x;
            const dy = targetY - pos.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const speed = 0.3 - (i * 0.05);
            
            if (distance > 1) {
              pos.x += dx * speed;
              pos.y += dy * speed;
              
              if (distance > 3) {
                const angle = Math.atan2(dy, dx) * (180 / Math.PI);
                let normalizedAngle = angle;
                if (normalizedAngle < 0) {
                  normalizedAngle += 360;
                }
                
                if (normalizedAngle > 90 && normalizedAngle <= 270) {
                  normalizedAngle = normalizedAngle - 180;
                }
                
                follower.style.transform = `rotate(${normalizedAngle}deg)`;
              }
              
              follower.style.left = (pos.x - 15) + 'px';
              follower.style.top = (pos.y - 15) + 'px';
            }
          }
        }
        requestAnimationFrame(animate);
      }
      
      document.addEventListener('mousemove', function(e) {
        window.mouseX = e.clientX;
        window.mouseY = e.clientY;
        
        if (!isMouseOnPage) {
          isMouseOnPage = true;
          followers.forEach(follower => {
            follower.style.display = 'block';
          });
        }
      });
      
      document.addEventListener('mouseleave', function() {
        isMouseOnPage = false;
        followers.forEach(follower => {
          follower.style.display = 'none';
        });
      });
      
      animate();
    });

    document.addEventListener('DOMContentLoaded', function() {
      const walkingChar = document.getElementById('walkingCharacter');
      let position = 0;
      let direction = 1;
      const speed = 2;
      const maxWidth = window.innerWidth - 50;
      
      function walk() {
        position += speed * direction;
        
        if (position >= maxWidth) {
          direction = -1;
          walkingChar.style.transform = 'scaleX(-1)';
        } else if (position <= 0) {
          direction = 1;
          walkingChar.style.transform = 'scaleX(1)';
        }
        
        walkingChar.style.left = position + 'px';
        requestAnimationFrame(walk);
      }
      
      walk();
    });
  </script>
  
<style>
  .fakeimg {
    height: 200px;
    background: #aaa;
  }

  .jumbotron {
    background-image: url("SitePics/rexbanner.png");
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    color: white;
  }

  .jumbotronfooter {
    background-image: url("SitePics/elizabanner.png");
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    color: white;
    padding: 50px;
  }
</style>
</head>
<body>

<div class="jumbotron jumbotron-fluid text-center" style="margin-bottom:0">
  <h1>Catherine Ann MacDonald</h1>
 <p style="color: #b82b2f; text-shadow: 2px 2px 0 white, -2px -2px 0 white, 2px -2px 0 white, -2px 2px 0 white, 0 2px 0 white, 0 -2px 0 white, 2px 0 0 white, -2px 0 0 white;"> Writer-Artist</p>
 <a href="ChatBot.html" style="text-decoration: none; transition: transform 0.2s ease; display: inline-block; position: relative;" onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'">
  <img src="TestBot/noise.gif" alt="noise" style="width: 22px; height: 15px; position: absolute; top: 5px; left: 5px;">
  <img src="TestBot/test.png" alt="computer" style="width: 32px; height: 32px; position: relative;">
 </a>
</div>

<nav class="navbar navbar-expand-sm navbar-dark" style="background-color: #b82b2f;">
  <a class="navbar-brand" href="#">Menu</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="index.html">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="currentportfolio.html">Current Portfolio</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="blog.html">Blog</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="projectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Projects
        </a>
        <div class="dropdown-menu" aria-labelledby="projectsDropdown">
          <a class="dropdown-item" href="spectrum.html">Spectrum</a>
          <a class="dropdown-item" href="party.html">Party</a>
          <div class="dropdown-divider"></div>
          <h6 class="dropdown-header">Fanart</h6>
          <a class="dropdown-item" href="Friends.html">Friends</a>
          <a class="dropdown-item" href="MediaILike.html">Media I Like</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="mediumsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Mediums
        </a>
        <div class="dropdown-menu" aria-labelledby="mediumsDropdown">
          <a class="dropdown-item" href="3D.html">3D</a>
          <a class="dropdown-item" href="Photography.html">Photography</a>
          <a class="dropdown-item" href="Writing.html">Writing</a>
          <a class="dropdown-item" href="Videos.html">Videos</a>
          <div class="dropdown-divider"></div>
          <h6 class="dropdown-header">Coding</h6>
          <a class="dropdown-item" href="Websites.html">Websites</a>
          <a class="dropdown-item" href="Games.html">Games</a>
          <a class="dropdown-item" href="Built-in.html">Built-in</a>
          <div class="dropdown-divider"></div>
          <h6 class="dropdown-header">Physical Media</h6>
          <a class="dropdown-item" href="Sculptures.html">Sculptures</a>
          <a class="dropdown-item" href="Paintings.html">Paintings</a>
          <a class="dropdown-item" href="Sketches.html">Sketches</a>
          <a class="dropdown-item" href="Drawings.html">Drawings</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="archiveDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Archive
        </a>
        <div class="dropdown-menu" aria-labelledby="archiveDropdown">
          <a class="dropdown-item" href="earlywork.html">Early Work</a>
          <a class="dropdown-item" href="OutdatedDesigns.html">Outdated Designs</a>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="Shop.html">Shop</a>
      </li>
    </ul>
  </div>  
</nav>

<div class="container" style="margin-top:30px">
  <div class="row">
    <div class="col-12">
      <h2 style="text-shadow: 2px 2px 0 white, -2px -2px 0 white, 2px -2px 0 white, -2px 2px 0 white, 0 2px 0 white, 0 -2px 0 white, 2px 0 0 white, -2px 0 0 white;">3D Art</h2>
      <h5 style="text-shadow: 2px 2px 0 white, -2px -2px 0 white, 2px -2px 0 white, -2px 2px 0 white, 0 2px 0 white, 0 -2px 0 white, 2px 0 0 white, -2px 0 0 white;">3D Models and Sculptures</h5>
      
      <!-- Magazine-Style Gallery -->
      <div class="row">
        <!-- Featured Character -->
        <div class="col-12 mb-4">
          <div class="card magazine-featured" style="background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9)); border: none; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
            <div class="row no-gutters">
              <div class="col-md-6">
            <img src="3D/finalpic.png" class="card-img" alt="Final Picture" style="height: 400px; object-fit: cover; object-position: center; cursor: pointer;" onclick="openModal(this, 'Final Picture', '')">
              </div>
              <div class="col-md-6 d-flex align-items-center">
                <div class="card-body text-center">
                  <h4 class="card-title" style="color: #b82b2f; font-weight: bold;">Featured Model</h4>
                  <h5 class="card-title">Final Picture</h5>
                  <p class="card-text">WIP</p>
                  <small class="text-muted">3D Art • Digital Sculpture</small>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Character Gallery -->
        <div class="col-md-6 mb-4">
          <div class="card magazine-card" style="background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9)); border: none; box-shadow: 0 4px 16px rgba(0,0,0,0.1); transition: transform 0.3s ease;">
            <img src="3D/folami.png" class="card-img-top" alt="Folami" style="height: 300px; object-fit: cover; object-position: center; cursor: pointer;" onclick="openModal(this, 'Folami', '')">
            <div class="card-body text-center">
              <h6 class="card-title" style="color: #b82b2f; font-weight: bold;">Folami</h6>
              <p class="card-text small">WIP</p>
              <small class="text-muted">3D Model</small>
            </div>
          </div>
        </div>
        
        <div class="col-md-6 mb-4">
          <div class="card magazine-card" style="background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9)); border: none; box-shadow: 0 4px 16px rgba(0,0,0,0.1); transition: transform 0.3s ease;">
            <img src="3D/sillyrender.png" class="card-img-top" alt="Silly Render" style="height: 300px; object-fit: cover; object-position: center; cursor: pointer;" onclick="openModal(this, 'Silly Render', '')">
            <div class="card-body text-center">
              <h6 class="card-title" style="color: #b82b2f; font-weight: bold;">Silly Render</h6>
              <p class="card-text small">WIP</p>
              <small class="text-muted">3D Art</small>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Interactive 3D Model Viewers -->
      <div class="row mt-5">
        <div class="col-12 mb-4">
          <h3 style="color: #b82b2f; text-shadow: 2px 2px 0 white, -2px -2px 0 white, 2px -2px 0 white, -2px 2px 0 white, 0 2px 0 white, 0 -2px 0 white, 2px 0 0 white, -2px 0 0 white;">Interactive 3D Models</h3>
          <p style="text-shadow: 2px 2px 0 white, -2px -2px 0 white, 2px -2px 0 white, -2px 2px 0 white, 0 2px 0 white, 0 -2px 0 white, 2px 0 0 white, -2px 0 0 white;">Drag to rotate • Scroll to zoom • Right-click to pan</p>
        </div>
        
        <!-- Clown Boy -->
        <div class="col-lg-6 mb-4">
          <div class="card magazine-card" style="background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9));">
            <div class="card-body">
              <h5 class="text-center" style="color: #b82b2f; font-weight: bold; margin-bottom: 15px;">Clown Boy</h5>
              <canvas id="viewer-clownboy" style="width: 100%; height: 400px; display: block; border-radius: 10px; background: linear-gradient(135deg, #1a1a2e, #16213e);"></canvas>
              <div class="text-center mt-3">
                <button onclick="resetCamera3D('clownboy')" style="background: #b82b2f; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 5px;">Reset</button>
                <button onclick="toggleWireframe3D('clownboy')" style="background: #b82b2f; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">Wireframe</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Depression Clown -->
        <div class="col-lg-6 mb-4">
          <div class="card magazine-card" style="background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9));">
            <div class="card-body">
              <h5 class="text-center" style="color: #b82b2f; font-weight: bold; margin-bottom: 15px;">Depression Clown</h5>
              <canvas id="viewer-depressionclown" style="width: 100%; height: 400px; display: block; border-radius: 10px; background: linear-gradient(135deg, #1a1a2e, #16213e);"></canvas>
              <div class="text-center mt-3">
                <button onclick="resetCamera3D('depressionclown')" style="background: #b82b2f; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 5px;">Reset</button>
                <button onclick="toggleWireframe3D('depressionclown')" style="background: #b82b2f; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">Wireframe</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Character Tester -->
        <div class="col-lg-6 mb-4">
          <div class="card magazine-card" style="background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9));">
            <div class="card-body">
              <h5 class="text-center" style="color: #b82b2f; font-weight: bold; margin-bottom: 15px;">The Character Tester</h5>
              <canvas id="viewer-thecharactertester" style="width: 100%; height: 400px; display: block; border-radius: 10px; background: linear-gradient(135deg, #1a1a2e, #16213e);"></canvas>
              <div class="text-center mt-3">
                <button onclick="resetCamera3D('thecharactertester')" style="background: #b82b2f; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 5px;">Reset</button>
                <button onclick="toggleWireframe3D('thecharactertester')" style="background: #b82b2f; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">Wireframe</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Vingette -->
        <div class="col-lg-6 mb-4">
          <div class="card magazine-card" style="background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9));">
            <div class="card-body">
              <h5 class="text-center" style="color: #b82b2f; font-weight: bold; margin-bottom: 15px;">Vingette</h5>
              <canvas id="viewer-vingette" style="width: 100%; height: 400px; display: block; border-radius: 10px; background: linear-gradient(135deg, #1a1a2e, #16213e);"></canvas>
              <div class="text-center mt-3">
                <button onclick="resetCamera3D('vingette')" style="background: #b82b2f; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 5px;">Reset</button>
                <button onclick="toggleWireframe3D('vingette')" style="background: #b82b2f; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">Wireframe</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<img id="walkingCharacter" class="walking-character" src="SitePics/Shadite.png" alt="Walking Character">

<div style="background-image: url('SitePics/elizabanner.png'); background-size: contain; background-position: center; background-repeat: no-repeat; padding: 20px; text-align: center; margin-top: 30px; border-radius: 10px; box-shadow: 0 -2px 8px rgba(0,0,0,0.1);">
  <p style="color: white; margin: 0; font-size: 18px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">Catherine Ann MacDonald</p>
  <p style="color: white; margin: 5px 0 0 0; font-size: 14px; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">&copy; 2025</p>
</div>

<style>
body {
  background-image: url("SitePics/spectrumbackground.png");
  background-size: 200% 100%;
  background-repeat: repeat-x;
  background-attachment: fixed;
  background-position: 0% 50%;
  font-family: Arial, sans-serif;
  animation: spectrumScroll 40s linear infinite;
}

@keyframes spectrumScroll {
  0% {
    background-position: 0% 50%;
  }
  100% {
    background-position: 200% 50%;
  }
}

.walking-character {
  position: fixed;
  bottom: 20px;
  width: 50px;
  height: 50px;
  z-index: 1000;
  transition: transform 0.1s ease-in-out;
}

body {
  color: black;
  font-family: Arial, sans-serif;
}

h1 {
  color: #b82b2f;
  font-family: Arial, sans-serif;
  text-shadow: 2px 2px 0 white, -2px -2px 0 white, 2px -2px 0 white, -2px 2px 0 white, 0 2px 0 white, 0 -2px 0 white, 2px 0 0 white, -2px 0 0 white;
}

.magazine-card:hover {
  transform: translateY(-5px);
}

.magazine-featured {
  border-radius: 15px;
  overflow: hidden;
}

.magazine-card {
  border-radius: 10px;
  overflow: hidden;
}
</style>

  <!-- Image Modal -->
  <div id="imageModal" class="modal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-image: url('SitePics/galaxy.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
    <span class="close" style="position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer;">&times;</span>
    <img class="modal-content" id="modalImage" style="margin: auto; display: block; width: 90%; max-width: 1200px; max-height: 90%; object-fit: contain;">
    <div id="caption" style="margin: auto; display: block; width: 80%; max-width: 700px; text-align: center; color: #ccc; padding: 10px 0; height: 150px;"></div>
  </div>

  <script>
    // Get the modal
    var modal = document.getElementById('imageModal');
    var modalImg = document.getElementById("modalImage");
    var captionText = document.getElementById("caption");
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks on an image, open the modal
    function openModal(img, title, description) {
      modal.style.display = "block";
      modalImg.src = img.src;
      captionText.innerHTML = '<h3 style="color: #b82b2f; margin-bottom: 10px;">' + title + '</h3><p style="font-size: 16px; line-height: 1.5;">' + description + '</p>';
    }

    // When the user clicks on (x), close the modal
    span.onclick = function() {
      modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        modal.style.display = "none";
      }
    });
  </script>
  
  <style>
/* Spotify Player Widget */
#spotifyWidget {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 300px;
  background: #000;
  border: 3px solid #1DB954;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  z-index: 9999;
  cursor: move;
}

#spotifyHeader {
  background: #1DB954;
  color: #fff;
  padding: 8px 12px;
  font-weight: bold;
  font-size: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: move;
  border-radius: 7px 7px 0 0;
}

#spotifyMinimize {
  background: none;
  border: none;
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  padding: 0 5px;
  line-height: 1;
}

#spotifyMinimize:hover {
  color: #000;
}
</style>

<!-- Draggable Spotify Player Widget -->
<div id="spotifyWidget">
  <div id="spotifyHeader">
    <span>🎵 Spotify Player</span>
    <div style="display: flex; gap: 5px;">
      <button id="spotifyRandomBtn" onclick="getRandomSpotifyTrack()" title="Get Random Track" style="background: none; border: none; color: #fff; font-size: 18px; cursor: pointer; padding: 0 5px; line-height: 1;">🎲</button>
      <button id="spotifyMinimize" onclick="toggleSpotifySpec()">+</button>
    </div>
  </div>
  <div id="spotifyContent" style="display: none;">
    <iframe id="spotifyIframe" style="border-radius: 0 0 7px 7px;" src="https://open.spotify.com/embed/playlist/66TP5uc6hwyESdV9AuvUZJ?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
    <div id="randomTrackDisplay" style="display: none; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 0 0 7px 7px; margin-top: -7px;"></div>
  </div>
</div>

<script>
// Set Spotify widget to minimized state on load
document.addEventListener('DOMContentLoaded', function() {
  const spotifyWidget = document.getElementById('spotifyWidget');
  if (spotifyWidget) {
    spotifyWidget.style.width = '200px';
  }
});
</script>

<script>
// Draggable Spotify Widget
let spotifySpecDragging = false;
let spotifySpecCurrentX;
let spotifySpecCurrentY;
let spotifySpecInitialX;
let spotifySpecInitialY;
let spotifySpecXOffset = 0;
let spotifySpecYOffset = 0;

const spotifySpecWidget = document.getElementById('spotifyWidget');
const spotifySpecHeader = document.getElementById('spotifyHeader');

spotifySpecHeader.addEventListener('mousedown', spotifySpecDragStart);
document.addEventListener('mousemove', spotifySpecDrag);
document.addEventListener('mouseup', spotifySpecDragEnd);

function spotifySpecDragStart(e) {
  spotifySpecInitialX = e.clientX - spotifySpecXOffset;
  spotifySpecInitialY = e.clientY - spotifySpecYOffset;
  
  if (e.target === spotifySpecHeader || e.target.parentElement === spotifySpecHeader) {
    spotifySpecDragging = true;
  }
}

function spotifySpecDrag(e) {
  if (spotifySpecDragging) {
    e.preventDefault();
    spotifySpecCurrentX = e.clientX - spotifySpecInitialX;
    spotifySpecCurrentY = e.clientY - spotifySpecInitialY;
    spotifySpecXOffset = spotifySpecCurrentX;
    spotifySpecYOffset = spotifySpecCurrentY;
    
    spotifySpecSetTranslate(spotifySpecCurrentX, spotifySpecCurrentY, spotifySpecWidget);
  }
}

function spotifySpecDragEnd(e) {
  spotifySpecInitialX = spotifySpecCurrentX;
  spotifySpecInitialY = spotifySpecCurrentY;
  spotifySpecDragging = false;
}

function spotifySpecSetTranslate(xPos, yPos, el) {
  el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
}

function toggleSpotifySpec() {
  const content = document.getElementById('spotifyContent');
  const btn = document.getElementById('spotifyMinimize');
  
  if (content.style.display === 'none') {
    content.style.display = 'block';
    btn.textContent = '−';
    spotifySpecWidget.style.width = '300px';
  } else {
    content.style.display = 'none';
    btn.textContent = '+';
    spotifySpecWidget.style.width = '200px';
  }
}
</script>

<!-- Spotify API Integration -->
<script src="js/spotify-integration.js"></script>
<script>
async function getRandomSpotifyTrack() {
  const display = document.getElementById('randomTrackDisplay');
  const content = document.getElementById('spotifyContent');
  const btn = document.getElementById('spotifyRandomBtn');
  
  if (content.style.display === 'none') {
    toggleSpotifySpec();
  }
  
  display.style.display = 'block';
  display.innerHTML = '<p style="color: #1DB954; margin: 0; text-align: center; font-size: 12px;">🎲 Getting random track...</p>';
  btn.style.opacity = '0.5';
  btn.disabled = true;
  
  try {
    if (typeof SpotifyAPI === 'undefined') {
      throw new Error('Spotify API script not loaded');
    }
    
    const track = await SpotifyAPI.getRandomTrack();
    
    if (track) {
      const artists = track.artists.map(a => a.name).join(', ');
      const albumImage = track.album.images[2]?.url || track.album.images[0]?.url;
      
      display.innerHTML = `
        <div style="display: flex; align-items: center; gap: 10px;">
          ${albumImage ? `<img src="${albumImage}" alt="${track.name}" style="width: 50px; height: 50px; border-radius: 5px;">` : ''}
          <div style="flex: 1; min-width: 0;">
            <div style="color: white; font-weight: bold; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${track.name}</div>
            <div style="color: #888; font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${artists}</div>
          </div>
          <a href="${track.external_urls.spotify}" target="_blank" style="color: #1DB954; text-decoration: none; padding: 5px 10px; border: 1px solid #1DB954; border-radius: 12px; font-size: 11px; white-space: nowrap; transition: all 0.2s;" onmouseover="this.style.background='#1DB954'; this.style.color='white'" onmouseout="this.style.background='transparent'; this.style.color='#1DB954'">Play</a>
        </div>
      `;
    } else {
      throw new Error('No track returned from API');
    }
  } catch (error) {
    console.error('❌ Spotify Error:', error);
    display.innerHTML = `
      <div style="text-align: center; padding: 5px;">
        <p style="color: #ff6b6b; margin: 0; font-size: 11px;">❌ ${error.message}</p>
        <button onclick="getRandomSpotifyTrack()" style="background: #1DB954; color: white; border: none; padding: 4px 12px; border-radius: 12px; font-size: 10px; margin-top: 5px; cursor: pointer;">Retry</button>
      </div>
    `;
  }
  
  btn.style.opacity = '1';
  btn.disabled = false;
}
</script>

<!-- 3D Model Viewer Script with MTL/Texture Support -->
<script type="module">
import * as THREE from 'three';
import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

const viewers = {};

function init3DViewer(modelName, objPath, mtlPath) {
  const canvas = document.getElementById(`viewer-${modelName}`);
  if (!canvas) {
    console.error('Canvas not found:', modelName);
    return;
  }
  
  console.log(`🔄 Initializing ${modelName}...`);
  
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x1a1a2e);
  
  const camera = new THREE.PerspectiveCamera(50, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
  camera.position.set(3, 3, 3);
  
  const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
  renderer.setSize(canvas.clientWidth, canvas.clientHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap; // Softer shadows
  
  // Lights
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
  scene.add(ambientLight);
  
  const dirLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
  dirLight1.position.set(5, 5, 5);
  dirLight1.castShadow = true;
  dirLight1.shadow.mapSize.width = 1024;
  dirLight1.shadow.mapSize.height = 1024;
  scene.add(dirLight1);
  
  const dirLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
  dirLight2.position.set(-5, -5, -5);
  scene.add(dirLight2);
  
  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.05;
  controls.minDistance = 1;
  controls.maxDistance = 10;
  
  let model = null;
  let materials = null;
  
  // Load MTL file first (if available), then OBJ
  if (mtlPath) {
    const mtlLoader = new MTLLoader();
    // Set both the path for MTL file and resource path for textures
    mtlLoader.setPath('3D/');
    mtlLoader.setResourcePath('3D/');
    
    // Configure texture loader for better quality
    mtlLoader.setMaterialOptions({
      side: THREE.DoubleSide,
      // Enable mipmaps and better filtering for textures
    });
    
    mtlLoader.load(
      mtlPath.replace('3D/', ''),
      (loadedMaterials) => {
        console.log(`✅ MTL loaded for ${modelName}`);
        materials = loadedMaterials;
        materials.preload();
        
        // Enhance texture settings after preload
        Object.values(materials.materials).forEach(material => {
          // Enable better texture filtering if textures exist
          if (material.map) {
            material.map.anisotropy = renderer.capabilities.getMaxAnisotropy();
            material.map.minFilter = THREE.LinearMipMapLinearFilter;
            material.map.magFilter = THREE.LinearFilter;
            console.log(`🖼️ Texture configured for ${modelName}:`, material.name);
          }
          // Enhance material properties
          material.side = THREE.DoubleSide;
        });
        
        loadOBJ(materials);
      },
      (xhr) => {
        if (xhr.lengthComputable) {
          console.log(`Loading ${modelName} MTL: ${Math.round(xhr.loaded / xhr.total * 100)}%`);
        }
      },
      (error) => {
        console.warn(`⚠️ MTL not found for ${modelName}, using default material`);
        console.error('MTL Error details:', error);
        loadOBJ(null);
      }
    );
  } else {
    loadOBJ(null);
  }
  
  function loadOBJ(materials) {
    const objLoader = new OBJLoader();
    
    if (materials) {
      objLoader.setMaterials(materials);
    }
    
    objLoader.load(
      objPath,
      (object) => {
        model = object;
        
        // If no materials were loaded, apply default red material
        if (!materials) {
          object.traverse((child) => {
            if (child.isMesh) {
              child.material = new THREE.MeshPhongMaterial({
                color: 0xb82b2f,
                shininess: 60,
                flatShading: false
              });
            }
          });
        } else {
          // If materials were loaded, ensure proper rendering settings
          object.traverse((child) => {
            if (child.isMesh) {
              // Enable shadow casting/receiving for better visual quality
              child.castShadow = true;
              child.receiveShadow = true;
              
              // Ensure material is using the right settings
              if (child.material) {
                child.material.needsUpdate = true;
                
                // Log if texture is present
                if (child.material.map) {
                  console.log(`✨ Mesh "${child.name}" has texture map`);
                }
              }
            }
          });
        }
        
        // Center and scale model
        const box = new THREE.Box3().setFromObject(object);
        const center = box.getCenter(new THREE.Vector3());
        const size = box.getSize(new THREE.Vector3());
        const maxDim = Math.max(size.x, size.y, size.z);
        const scale = 2 / maxDim;
        
        object.scale.setScalar(scale);
        object.position.sub(center.multiplyScalar(scale));
        
        scene.add(object);
        
        const textureInfo = materials ? 'MTL materials' : 'default material';
        console.log(`✅ ${modelName} loaded successfully with ${textureInfo}`);
      },
      (xhr) => {
        if (xhr.lengthComputable) {
          console.log(`Loading ${modelName} OBJ: ${Math.round(xhr.loaded / xhr.total * 100)}%`);
        }
      },
      (error) => {
        console.error(`❌ Error loading ${modelName}:`, error);
        console.error('Error details:', { path: objPath, message: error.message });
      }
    );
  }
  
  viewers[modelName] = {
    scene, camera, renderer, controls,
    getModel: () => model,
    getMaterials: () => materials,
    initialPos: camera.position.clone(),
    wireframe: false
  };
  
  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }
  animate();
  
  window.addEventListener('resize', () => {
    camera.aspect = canvas.clientWidth / canvas.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(canvas.clientWidth, canvas.clientHeight);
  });
}

window.resetCamera3D = (name) => {
  const v = viewers[name];
  if (v) {
    v.camera.position.copy(v.initialPos);
    v.controls.reset();
    console.log(`🔄 Camera reset: ${name}`);
  }
};

window.toggleWireframe3D = (name) => {
  const v = viewers[name];
  if (v && v.getModel()) {
    v.wireframe = !v.wireframe;
    v.getModel().traverse((child) => {
      if (child.isMesh) {
        child.material.wireframe = v.wireframe;
      }
    });
    console.log(`🔲 Wireframe ${v.wireframe ? 'ON' : 'OFF'}: ${name}`);
  }
};

// Initialize all viewers - only vingette uses MTL, others use default red material
console.log('🚀 Initializing 3D viewers...');
setTimeout(() => {
  init3DViewer('clownboy', '3D/clownboy.obj', null);
  init3DViewer('depressionclown', '3D/depressionclown.obj', null);
  init3DViewer('thecharactertester', '3D/thecharactertester.obj', null);
  init3DViewer('vingette', '3D/vingette.obj', '3D/vingette.mtl');
}, 500);
</script>

</body>
</html>
